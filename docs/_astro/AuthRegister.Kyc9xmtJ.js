import{r as i,j as e}from"./react.C3Okw6ig.js";import{s as H}from"./supabaseClient.D_vLzryr.js";import{u as d}from"./userStore.CErzcb8o.js";import{H as M}from"./@hcaptcha.BsbZC_HM.js";import{O as V}from"./OAuthLogin.B_FBpQNv.js";import{C as Z,b as D,M as O,U as W,c as C,E as z,d as k,I as B,L as G}from"./lucide-react.D5kojTiz.js";import"./@supabase.dO6uEFJg.js";import"./Page.astro_astro_type_script_index_0_lang.tntsxO7H.js";import"./react-dom.BGHTHZuc.js";import"./svelte.BVVFYaGB.js";import"./esm-env.rsSWfq8L.js";import"./@nanostores.D3epgRK9.js";import"./nanostores.B6d4-zKA.js";import"./@babel.iCE8PrbV.js";const ce=({redirectTo:w="/",onSuccess:v,onSwitchToLogin:N,className:S=""})=>{const[s,h]=i.useState({email:"",password:"",confirmPassword:"",username:""}),[f,E]=i.useState(!1),[p,A]=i.useState(!1),[l,y]=i.useState(!1),[b,m]=i.useState(null),[g,j]=i.useState(null),[P,o]=i.useState(null),[c,U]=i.useState(0),u=i.useRef(null),L="10000000-ffff-ffff-ffff-000000000001",q=t=>{let a=0;return t.length>=8&&(a+=1),/[a-z]/.test(t)&&(a+=1),/[A-Z]/.test(t)&&(a+=1),/[0-9]/.test(t)&&(a+=1),/[^A-Za-z0-9]/.test(t)&&(a+=1),a},F=t=>{switch(t){case 0:case 1:return"Very Weak";case 2:return"Weak";case 3:return"Fair";case 4:return"Good";case 5:return"Strong";default:return"Very Weak"}},_=t=>{switch(t){case 0:case 1:return"bg-red-500";case 2:return"bg-orange-500";case 3:return"bg-yellow-500";case 4:return"bg-blue-500";case 5:return"bg-green-500";default:return"bg-red-500"}},x=t=>{const{name:a,value:r}=t.target;h(n=>({...n,[a]:r})),a==="password"&&U(q(r)),b&&m(null),g&&j(null)},$=t=>{o(t)},I=()=>{o(null)},R=()=>s.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)?s.username.trim()?s.username.length<3?"Username must be at least 3 characters long":/^[a-zA-Z0-9_-]+$/.test(s.username)?s.password.trim()?s.password.length<8?"Password must be at least 8 characters long":c<3?"Password is too weak. Please include uppercase, lowercase, numbers, and special characters":s.password!==s.confirmPassword?"Passwords do not match":P?null:"Please complete the captcha verification":"Password is required":"Username can only contain letters, numbers, underscores, and hyphens":"Username is required":"Please enter a valid email address":"Email is required",T=async t=>{t.preventDefault();const a=R();if(a){m(a);return}try{y(!0),m(null),j(null),d.setLoading(!0),d.setError(null);const{data:r,error:n}=await H.auth.signUp({email:s.email,password:s.password,options:{data:{username:s.username,display_name:s.username}}});if(n)throw n;r.user&&(r.user.email_confirmed_at?(d.setAuth(r.session,{id:r.user.id,email:r.user.email,username:s.username,display_name:s.username}),h({email:"",password:"",confirmPassword:"",username:""}),o(null),u.current?.resetCaptcha(),v?v():window.location.href=w):(j(`A confirmation email has been sent to ${s.email}. Please check your inbox and click the confirmation link to complete your registration.`),h({email:"",password:"",confirmPassword:"",username:""}),o(null),u.current?.resetCaptcha()))}catch(r){console.error("Registration error:",r);let n="An error occurred during registration";r instanceof Error&&(r.message.includes("User already registered")?n="An account with this email already exists. Please sign in instead.":r.message.includes("Password should be")?n="Password does not meet security requirements":r.message.includes("Invalid email")?n="Please enter a valid email address":r.message.includes("username")?n="Username is already taken. Please choose a different one.":n=r.message),m(n),d.setError(n),o(null),u.current?.resetCaptcha()}finally{y(!1),d.setLoading(!1)}};return e.jsx("div",{className:`max-w-md mx-auto ${S}`,children:e.jsxs("div",{className:"bg-zinc-800/80 backdrop-blur-lg rounded-2xl shadow-2xl p-8 border border-zinc-700",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Join the Meme Community"}),e.jsx("p",{className:"text-neutral-400",children:"Create your account and start sharing"})]}),e.jsx(V,{redirectTo:w,showTitle:!1,className:"mb-6"}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-zinc-700"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-zinc-800 text-neutral-400",children:"or register with email"})})]}),g&&e.jsxs("div",{className:"mb-6 p-4 rounded-lg bg-green-500/10 border border-green-500/20 flex items-start space-x-3",children:[e.jsx(Z,{size:20,className:"text-green-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-green-400",children:g})]}),b&&e.jsxs("div",{className:"mb-6 p-4 rounded-lg bg-red-500/10 border border-red-500/20 flex items-start space-x-3",children:[e.jsx(D,{size:20,className:"text-red-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-red-400",children:b})]}),e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-neutral-300 mb-2",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(O,{size:20,className:"text-neutral-500"})}),e.jsx("input",{type:"email",id:"email",name:"email",value:s.email,onChange:x,className:"w-full pl-10 pr-4 py-3 bg-zinc-900/50 border border-zinc-600 rounded-lg text-white placeholder-neutral-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all",placeholder:"Enter your email",disabled:l,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-neutral-300 mb-2",children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(W,{size:20,className:"text-neutral-500"})}),e.jsx("input",{type:"text",id:"username",name:"username",value:s.username,onChange:x,className:"w-full pl-10 pr-4 py-3 bg-zinc-900/50 border border-zinc-600 rounded-lg text-white placeholder-neutral-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all",placeholder:"Choose a username",disabled:l,required:!0,minLength:3,pattern:"^[a-zA-Z0-9_-]+$"})]}),e.jsx("p",{className:"mt-1 text-xs text-neutral-500",children:"3+ characters, letters, numbers, underscores, and hyphens only"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-neutral-300 mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(C,{size:20,className:"text-neutral-500"})}),e.jsx("input",{type:f?"text":"password",id:"password",name:"password",value:s.password,onChange:x,className:"w-full pl-10 pr-12 py-3 bg-zinc-900/50 border border-zinc-600 rounded-lg text-white placeholder-neutral-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all",placeholder:"Create a strong password",disabled:l,required:!0,minLength:8}),e.jsx("button",{type:"button",onClick:()=>E(!f),className:"absolute inset-y-0 right-0 pr-3 flex items-center",disabled:l,children:f?e.jsx(z,{size:20,className:"text-neutral-500 hover:text-neutral-400"}):e.jsx(k,{size:20,className:"text-neutral-500 hover:text-neutral-400"})})]}),s.password&&e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"flex-1 bg-zinc-700 rounded-full h-1",children:e.jsx("div",{className:`h-1 rounded-full transition-all duration-300 ${_(c)}`,style:{width:`${c/5*100}%`}})}),e.jsx("span",{className:"text-xs text-neutral-400",children:F(c)})]})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-neutral-300 mb-2",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(C,{size:20,className:"text-neutral-500"})}),e.jsx("input",{type:p?"text":"password",id:"confirmPassword",name:"confirmPassword",value:s.confirmPassword,onChange:x,className:"w-full pl-10 pr-12 py-3 bg-zinc-900/50 border border-zinc-600 rounded-lg text-white placeholder-neutral-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all",placeholder:"Confirm your password",disabled:l,required:!0}),e.jsx("button",{type:"button",onClick:()=>A(!p),className:"absolute inset-y-0 right-0 pr-3 flex items-center",disabled:l,children:p?e.jsx(z,{size:20,className:"text-neutral-500 hover:text-neutral-400"}):e.jsx(k,{size:20,className:"text-neutral-500 hover:text-neutral-400"})})]}),s.confirmPassword&&s.password!==s.confirmPassword&&e.jsx("p",{className:"mt-1 text-xs text-red-400",children:"Passwords do not match"})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(M,{ref:u,sitekey:L,onVerify:$,onExpire:I,theme:"dark"})}),e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-zinc-900/30 rounded-lg border border-zinc-700",children:[e.jsx(B,{size:16,className:"text-blue-400 mt-0.5 flex-shrink-0"}),e.jsxs("p",{className:"text-xs text-neutral-400",children:["By creating an account, you agree to our"," ",e.jsx("a",{href:"/terms",className:"text-emerald-400 hover:text-emerald-300 underline",children:"Terms of Service"})," ","and"," ",e.jsx("a",{href:"/privacy",className:"text-emerald-400 hover:text-emerald-300 underline",children:"Privacy Policy"}),"."]})]}),e.jsx("button",{type:"submit",disabled:l||!P||c<3,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-emerald-500 to-green-500 hover:from-emerald-600 hover:to-green-600 disabled:from-emerald-500/50 disabled:to-green-500/50 text-white rounded-lg font-medium transition-all duration-200 transform hover:scale-[1.02] disabled:transform-none disabled:cursor-not-allowed",children:l?e.jsxs(e.Fragment,{children:[e.jsx(G,{size:20,className:"animate-spin"}),e.jsx("span",{children:"Creating account..."})]}):e.jsx("span",{children:"Create Account"})})]}),N&&e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-neutral-400",children:["Already have an account?"," ",e.jsx("button",{onClick:N,className:"text-emerald-400 hover:text-emerald-300 font-medium transition-colors",disabled:l,children:"Sign in"})]})})]})})};export{ce as AuthRegister};
