let f=[],v=(e,u)=>{let i=[],t={get(){return t.lc||t.listen(()=>{})(),t.value},l:0,lc:0,listen(n,s){return t.lc=i.push(n,s||t.l)/2,()=>{let l=i.indexOf(n);~l&&(i.splice(l,2),--t.lc||t.off())}},notify(n){let s=!f.length;for(let l=0;l<i.length;l+=2)f.push(i[l],i[l+1],t.value,n);if(s){for(let l=0;l<f.length;l+=4){let T;for(let r=l+1;!T&&(r+=4)<f.length;)f[r]<f[l+1]&&(T=f.push(f[l],f[l+1],f[l+2],f[l+3]));T||f[l](f[l+2],f[l+3])}f.length=0}},off(){},set(n){t.value!==n&&(t.value=n,t.notify())},subscribe(n,s){let l=t.listen(n,s);return n(t.value),l},value:e};return t};let N=(e,u,i,t)=>(e.events=e.events||{},e.events[i+10]||(e.events[i+10]=t(n=>{e.events[i].reduceRight((s,l)=>(l(s),s),{shared:{},...n})})),e.events[i]=e.events[i]||[],e.events[i].push(u),()=>{let n=e.events[i],s=n.indexOf(u);n.splice(s,1),n.length||(delete e.events[i],e.events[i+10](),delete e.events[i+10])}),U=1e3,O=(e,u)=>N(e,t=>{let n=u(t);n&&e.events[6].push(n)},5,t=>{let n=e.listen;e.listen=(...l)=>(!e.lc&&!e.active&&(e.active=!0,t()),n(...l));let s=e.off;return e.events[6]=[],e.off=()=>{s(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let l of e.events[6])l();e.events[6]=[]}},U)},()=>{e.listen=n,e.off=s}});function a(e,u,i){let t=new Set([...u,void 0]);return e.listen((n,s)=>{t.has(s)&&i(n,s)})}export{v as a,a as l,O as o};
