import{a as c}from"./index.CMSeyhcG.js";const g=5,u=6,v=10;let L=(e,s,n,r)=>(e.events=e.events||{},e.events[n+v]||(e.events[n+v]=r(t=>{e.events[n].reduceRight((i,d)=>(d(i),i),{shared:{},...t})})),e.events[n]=e.events[n]||[],e.events[n].push(s),()=>{let t=e.events[n],i=t.indexOf(s);t.splice(i,1),t.length||(delete e.events[n],e.events[n+v](),delete e.events[n+v])}),p=1e3,h=(e,s)=>L(e,r=>{let t=s(r);t&&e.events[u].push(t)},g,r=>{let t=e.listen;e.listen=(...d)=>(!e.lc&&!e.active&&(e.active=!0,r()),t(...d));let i=e.off;return e.events[u]=[],e.off=()=>{i(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let d of e.events[u])d();e.events[u]=[]}},p)},()=>{e.listen=t,e.off=i}}),w=e=>e,f={},a={addEventListener(){},removeEventListener(){}};function T(){try{return typeof localStorage<"u"}catch{return!1}}T()&&(f=localStorage);let O={addEventListener(e,s,n){window.addEventListener("storage",s),window.addEventListener("pageshow",n)},removeEventListener(e,s,n){window.removeEventListener("storage",s),window.removeEventListener("pageshow",n)}};typeof window<"u"&&(a=O);function U(e,s=void 0,n={}){let r=n.encode||w,t=n.decode||w,i=c(s),d=i.set;i.set=l=>{typeof l>"u"?delete f[e]:f[e]=r(l),d(l)};function E(l){l.key===e?l.newValue===null?d(void 0):d(t(l.newValue)):f[e]||d(void 0)}function o(){i.set(f[e]?t(f[e]):s)}return h(i,()=>{if(o(),n.listen!==!1)return a.addEventListener(e,E,o),()=>{a.removeEventListener(e,E,o)}}),i}export{U as p};
