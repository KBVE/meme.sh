const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/index.CoaMyoED.js","_astro/index.1Jp-s5Xv.js","_astro/preload-helper.BlTxHScW.js"])))=>i.map(i=>d[i]);
import{_ as y}from"./preload-helper.BlTxHScW.js";import{p as g}from"./index.CvL_fmfE.js";import{a as m}from"./index.CMSeyhcG.js";import{r as f}from"./index.1Jp-s5Xv.js";const p=g("user-authenticated",!1,{encode:e=>String(e),decode:e=>e==="true"}),A=m(!1),v=m(null),h=g("user-session",null,{encode:JSON.stringify,decode:e=>e?JSON.parse(e):null}),n=g("user-profile",null,{encode:JSON.stringify,decode:e=>e?JSON.parse(e):null}),c=g("user-preferences",{theme:"dark",language:"en",timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,email_notifications:!0,push_notifications:!1,content_filter:"mild",autoplay_videos:!0,show_nsfw:!1},{encode:JSON.stringify,decode:e=>e?JSON.parse(e):void 0}),u=m({liked_memes:new Set,viewed_memes:new Set,shared_memes:new Set,recently_viewed:[],bookmarked_memes:new Set}),O=m({drafts:[],uploaded_memes:[],upload_history:[]}),d=m({followers:[],following:[],blocked_users:[],muted_users:[]}),l={setAuth:(e,t)=>{if(p.set(!!e),h.set(e),e?.user&&t){const s={id:e.user.id,uuid:e.user.id,email:e.user.email,username:e.user.user_metadata?.username||t.username,avatar_url:e.user.user_metadata?.avatar_url||t.avatar_url,full_name:e.user.user_metadata?.full_name||t.full_name,display_name:t.display_name||e.user.user_metadata?.username||t.username,bio:t.bio,website:t.website,location:t.location,user_metadata:e.user.user_metadata,app_metadata:e.user.app_metadata,email_verified:!!e.user.email_confirmed_at,phone_verified:!!e.user.phone_confirmed_at,is_premium:t.is_premium||!1,is_creator:t.is_creator||!1,is_admin:t.is_admin||!1,created_at:e.user.created_at,updated_at:e.user.updated_at,last_sign_in_at:e.user.last_sign_in_at,preferences:{theme:t.preferences&&t.preferences.theme!==void 0?t.preferences.theme:c.get()?.theme??"dark",language:t.preferences&&t.preferences.language!==void 0?t.preferences.language:c.get()?.language??"en",timezone:t.preferences&&t.preferences.timezone!==void 0?t.preferences.timezone:c.get()?.timezone??Intl.DateTimeFormat().resolvedOptions().timeZone,email_notifications:t.preferences&&t.preferences.email_notifications!==void 0?t.preferences.email_notifications:c.get()?.email_notifications??!0,push_notifications:t.preferences&&t.preferences.push_notifications!==void 0?t.preferences.push_notifications:c.get()?.push_notifications??!1,content_filter:t.preferences&&t.preferences.content_filter!==void 0?t.preferences.content_filter:c.get()?.content_filter??"mild",autoplay_videos:t.preferences&&t.preferences.autoplay_videos!==void 0?t.preferences.autoplay_videos:c.get()?.autoplay_videos??!0,show_nsfw:t.preferences&&t.preferences.show_nsfw!==void 0?t.preferences.show_nsfw:c.get()?.show_nsfw??!1},stats:t.stats||{memes_created:0,memes_liked:0,followers_count:0,following_count:0,total_views:0,total_likes_received:0,join_date:e.user.created_at,last_active:new Date().toISOString()}};n.set(s)}},logout:()=>{p.set(!1),h.set(null),n.set(null),v.set(null),u.set({liked_memes:new Set,viewed_memes:new Set,shared_memes:new Set,recently_viewed:[],bookmarked_memes:new Set})},setLoading:e=>{A.set(e)},setError:e=>{v.set(e)},updateProfile:e=>{const t=n.get();t&&n.set({...t,...e,updated_at:new Date().toISOString()})},updatePreferences:e=>{const s={...c.get(),...e},a={theme:s.theme??"dark",language:s.language??"en",timezone:s.timezone??Intl.DateTimeFormat().resolvedOptions().timeZone,email_notifications:s.email_notifications??!0,push_notifications:s.push_notifications??!1,content_filter:s.content_filter??"mild",autoplay_videos:s.autoplay_videos??!0,show_nsfw:s.show_nsfw??!1};c.set(a);const i=n.get();i&&n.set({...i,preferences:a,updated_at:new Date().toISOString()})},updateStats:e=>{const t=n.get();t?.stats&&n.set({...t,stats:{...t.stats,...e,last_active:new Date().toISOString()},updated_at:new Date().toISOString()})},updateBasicProfile:e=>{const t=n.get();t&&n.set({...t,...e,updated_at:new Date().toISOString()})},updateAvatar:e=>{const t=n.get();t&&n.set({...t,avatar_url:e,updated_at:new Date().toISOString()})},updateAccountSettings:e=>{const t=n.get();t&&n.set({...t,...e,updated_at:new Date().toISOString()})},validateProfile:()=>{const e=n.get();if(!e)return{valid:!1,errors:["No profile found"]};const t=[];return e.email||t.push("Email is required"),e.username&&e.username.length<3&&t.push("Username must be at least 3 characters"),e.bio&&e.bio.length>500&&t.push("Bio must be less than 500 characters"),e.website&&!e.website.match(/^https?:\/\/.+/)&&t.push("Website must be a valid URL"),{valid:t.length===0,errors:t}},likeMeme:e=>{const t=u.get(),s=new Set(t.liked_memes);s.add(e),u.set({...t,liked_memes:s});const a=n.get();a?.stats&&l.updateStats({memes_liked:a.stats.memes_liked+1})},unlikeMeme:e=>{const t=u.get(),s=new Set(t.liked_memes);s.delete(e),u.set({...t,liked_memes:s});const a=n.get();a?.stats&&l.updateStats({memes_liked:Math.max(0,a.stats.memes_liked-1)})},viewMeme:e=>{const t=u.get(),s=new Set(t.viewed_memes);s.add(e);const a=[e,...t.recently_viewed.filter(i=>i!==e)].slice(0,50);u.set({...t,viewed_memes:s,recently_viewed:a})},bookmarkMeme:e=>{const t=u.get(),s=new Set(t.bookmarked_memes);s.has(e)?s.delete(e):s.add(e),u.set({...t,bookmarked_memes:s})},shareMeme:e=>{const t=u.get(),s=new Set(t.shared_memes);s.add(e),u.set({...t,shared_memes:s})},followUser:e=>{const t=d.get(),s=[...t.following];if(!s.includes(e)){s.push(e),d.set({...t,following:s});const a=n.get();a?.stats&&l.updateStats({following_count:a.stats.following_count+1})}},unfollowUser:e=>{const t=d.get(),s=t.following.filter(i=>i!==e);d.set({...t,following:s});const a=n.get();a?.stats&&l.updateStats({following_count:Math.max(0,a.stats.following_count-1)})},blockUser:e=>{const t=d.get(),s=[...t.blocked_users];if(!s.includes(e)){s.push(e);const a=t.following.filter(i=>i!==e);d.set({...t,blocked_users:s,following:a})}},unblockUser:e=>{const t=d.get(),s=t.blocked_users.filter(a=>a!==e);d.set({...t,blocked_users:s})},isLiked:e=>u.get().liked_memes.has(e),isBookmarked:e=>u.get().bookmarked_memes.has(e),isFollowing:e=>d.get().following.includes(e),isBlocked:e=>d.get().blocked_users.includes(e),getDisplayName:()=>{const e=n.get();return e?.display_name||e?.username||e?.full_name||e?.email?.split("@")[0]||"Anonymous User"},getAvatarUrl:()=>{const e=n.get();return e?.avatar_url||`https://api.dicebear.com/7.x/avataaars/svg?seed=${e?.email||"default"}`},resetUserData:()=>{l.logout(),c.set({theme:"dark",language:"en",timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,email_notifications:!0,push_notifications:!1,content_filter:"mild",autoplay_videos:!0,show_nsfw:!1}),O.set({drafts:[],uploaded_memes:[],upload_history:[]}),d.set({followers:[],following:[],blocked_users:[],muted_users:[]})}},D=async()=>{try{const{createClient:e}=await y(async()=>{const{createClient:r}=await import("./index.CoaMyoED.js");return{createClient:r}},__vite__mapDeps([0,1,2])),t=void 0,s=void 0;if(!t||!s){console.warn("Supabase configuration missing");return}const a=e(t,s),i=h.get();if(p.get()&&i)try{const{data:r,error:o}=await a.auth.setSession(i);o||!r.session?(console.log("Persisted session invalid, clearing state"),l.logout()):(console.log("Persisted session valid, updating profile"),l.setAuth(r.session,{id:r.session.user.id,email:r.session.user.email,username:r.session.user.user_metadata?.username||r.session.user.user_metadata?.user_name||r.session.user.user_metadata?.name,avatar_url:r.session.user.user_metadata?.avatar_url,full_name:r.session.user.user_metadata?.full_name}))}catch(r){console.log("Error validating persisted session:",r),l.logout()}else{const{data:{session:r},error:o}=await a.auth.getSession();if(o){console.error("Error getting session:",o);return}r?.user&&l.setAuth(r,{id:r.user.id,email:r.user.email,username:r.user.user_metadata?.username||r.user.user_metadata?.user_name||r.user.user_metadata?.name,avatar_url:r.user.user_metadata?.avatar_url,full_name:r.user.user_metadata?.full_name})}const{data:{subscription:w}}=a.auth.onAuthStateChange((r,o)=>{console.log("Auth state change:",r,o?.user?.email),r==="SIGNED_IN"&&o?.user?l.setAuth(o,{id:o.user.id,email:o.user.email,username:o.user.user_metadata?.username||o.user.user_metadata?.user_name||o.user.user_metadata?.name,avatar_url:o.user.user_metadata?.avatar_url,full_name:o.user.user_metadata?.full_name}):r==="SIGNED_OUT"&&l.logout()});return w}catch(e){console.error("Auth initialization failed:",e)}};typeof window<"u"&&D();const N=m(""),E=m("");n.subscribe(e=>{N.set(l.getDisplayName()),E.set(l.getAvatarUrl())});/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),k=(...e)=>e.filter((t,s,a)=>!!t&&a.indexOf(t)===s).join(" ");/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var P={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=f.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:s=2,absoluteStrokeWidth:a,className:i="",children:_,iconNode:w,...r},o)=>f.createElement("svg",{ref:o,...P,width:t,height:t,stroke:e,strokeWidth:a?Number(s)*24/Number(t):s,className:k("lucide",i),...r},[...w.map(([S,b])=>f.createElement(S,b)),...Array.isArray(_)?_:[_]]));/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=(e,t)=>{const s=f.forwardRef(({className:a,...i},_)=>f.createElement(C,{ref:_,iconNode:t,className:k(`lucide-${U(e)}`,a),...i}));return s.displayName=`${e}`,s};export{n as a,A as b,z as c,p as i,l as u};
